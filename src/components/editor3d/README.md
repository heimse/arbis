# 3D Визуализатор планировки (Plan3DViewer)

Модуль для трёхмерной визуализации планировок, созданных в 2D редакторе.

## Компоненты

### Plan3DViewer

Главный компонент 3D-визуализатора.

**Props:**

- `state: EditorState` - состояние редактора с данными планировки
- `className?: string` - CSS класс
- `style?: React.CSSProperties` - inline стили

**Функционал:**

- Автоматический расчёт bounding box для оптимального расположения камеры
- Поддержка видимости слоёв
- Орбитальная камера с ограничениями
- Освещение и тени
- Сетка для ориентации

### Walls3D

Компонент для отрисовки стен в 3D.

**Особенности:**

- Поддержка двух типов стен: несущие (`load-bearing`) и перегородки (`partition`)
- Автоматическое создание проёмов для дверей и окон
- Разбиение стен на сегменты с учётом проёмов
- Тени и реалистичные материалы

### Floor3D

Компонент базового пола.

**Особенности:**

- Автоматическая подгонка под размеры планировки
- Реалистичный материал
- Приём теней от других объектов

### Rooms3D

Компонент для отрисовки комнат.

**Особенности:**

- Поддержка произвольных полигонов
- Уникальные пастельные цвета для каждой комнаты
- Полупрозрачность для лучшей читаемости
- Автоматический fallback на прямоугольники

## Система координат

В 3D используется следующая система координат:

- **X** - горизонтальная ось (соответствует `node.x` из 2D)
- **Y** - вертикальная ось (высота)
- **Z** - горизонтальная ось (соответствует `node.y` из 2D)

Все размеры в метрах. Толщины стен, размеры проёмов в исходных данных указаны в мм и автоматически конвертируются (`/1000`).

## Константы

- `DEFAULT_WALL_HEIGHT = 2.8` метра - высота стен по умолчанию

## Управление камерой

- **ЛКМ** - вращение камеры вокруг центра
- **СКМ / ПКМ** - панорамирование
- **Колесо мыши** - зум
- Камера автоматически ограничена и не может опуститься ниже пола

## Интеграция

Компонент интегрирован в `Editor2D` через переключатель режимов 2D/3D в верхней панели.

```tsx
import { Plan3DViewer } from "@/components/editor3d";

<Plan3DViewer state={editorState} className="w-full h-full" />;
```

## Производительность

- Используется инстансинг для одинаковых объектов
- Оптимизированная геометрия с минимальным количеством полигонов
- Кэширование вычислений через `useMemo`
- Ленивая загрузка текстур

## Дальнейшее развитие

Планируются следующие улучшения:

1. **Двери и окна** - визуализация дверных полотен и оконных рам
2. **Мебель** - отрисовка мебели из 2D редактора в 3D
3. **Материалы** - поддержка различных материалов для стен и полов
4. **Текстуры** - добавление реалистичных текстур
5. **Освещение** - настраиваемые источники света
6. **Экспорт** - экспорт 3D модели в форматы GLB/GLTF
7. **VR режим** - поддержка просмотра в виртуальной реальности
